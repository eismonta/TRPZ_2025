<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ì—Ä–∞—Ñ—ñ—á–Ω–∏–π –†–µ–¥–∞–∫—Ç–æ—Ä (Lab 4)</title>
    <style>
        body { background: #f4f4f4; font-family: Arial, sans-serif; text-align: center; }
        canvas { background: white; border: 2px solid #333; cursor: crosshair; }
        .toolbar { margin: 10px; padding: 10px; background: #ddd; border-radius: 5px; display: inline-block;}
        button { padding: 5px 10px; margin: 0 5px; cursor: pointer; border: 1px solid #999; border-radius: 3px;}
        button:hover { opacity: 0.8; }
    </style>
</head>
<body>
    <div class="toolbar">
        <button onclick="setTool('brush')">‚úèÔ∏è –ü–µ–Ω–∑–ª–∏–∫</button>
        <button onclick="setTool('eraser')">üßΩ –ì—É–º–∫–∞</button>
        <button onclick="clearCanvas()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏</button>

        <span style="margin: 0 15px; color: #aaa;">|</span>

        <button onclick="changeState('active')" style="background: #007bff; color: white;">üîì –ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏</button>
        <button onclick="changeState('archived')" style="background: #6c757d; color: white;">üîí –ê—Ä—Ö—ñ–≤—É–≤–∞—Ç–∏</button>

        <span style="margin: 0 15px; color: #aaa;">|</span>

        <button onclick="saveToServer()" style="background: #28a745; color: white;">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –ë–î</button>
    </div>
    
    <br>
    <canvas id="c" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let tool = 'brush';

        // --- –õ–æ–≥—ñ–∫–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è ---
        canvas.onmousedown = (e) => { isDrawing = true; ctx.beginPath(); ctx.moveTo(e.offsetX, e.offsetY); };
        canvas.onmouseup = () => isDrawing = false;
        canvas.onmousemove = (e) => {
            if (!isDrawing) return;
            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.strokeStyle = (tool === 'brush') ? 'black' : 'white';
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();
        };

        function setTool(t) { tool = t; }
        function clearCanvas() { ctx.clearRect(0,0,800,600); }

        // --- –§—É–Ω–∫—Ü—ñ—è –∑–º—ñ–Ω–∏ —Å—Ç–∞–Ω—É (–ü–∞—Ç–µ—Ä–Ω State) ---
        function changeState(status) {
            fetch('/api/state?status=' + status, { method: 'POST' })
            .then(r => r.text())
            .then(msg => alert("–°–µ—Ä–≤–µ—Ä: " + msg));
        }

        // --- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è (–ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º) ---
        function saveToServer() {
            const data = canvas.toDataURL();
            fetch('/api/save', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({name: 'MyDrawing', imageData: data})
            })
            .then(r => r.text())
            .then(msg => {
                // –Ø–∫—â–æ –ø—Ä–∏–π–¥–µ –ø–æ–º–∏–ª–∫–∞ (—Å—Ç–∞–Ω Archived), –º–∏ —ó—ó –ø–æ–±–∞—á–∏–º–æ —Ç—É—Ç
                alert("–í—ñ–¥–ø–æ–≤—ñ–¥—å —Å–µ—Ä–≤–µ—Ä–∞: " + msg);
            });
        }
    </script>
</body>
</html>